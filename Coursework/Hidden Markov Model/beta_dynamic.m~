function [beta] = beta_dynamic(M, B, P, v) 
    length_v = length(v);
length_P = length(P);
beta =zeros(length_P,length_v);%initialize the matrix 
    
    beta(:,length_v)=1;%initialise the final row with ones
    prob_v_given_s_j = zeros(length(P),length(P),length(v)-1);%generate the diagonal matrix of v given s_t for 
    %t=length v, length v-1,...,
    
    for t =1:length_P
        for j = 1:length(P)
                prob_v_given_s_j(j,j,t)=B(j,v(length(v)+1-t));%a diagonal matrix for each iteration of t
        end
    end
    
    for i=length_v-1:-1:1
       beta(:,i) =M * prob_v_given_s_j(:,:,i) * beta(:,i+1);
    end
end

